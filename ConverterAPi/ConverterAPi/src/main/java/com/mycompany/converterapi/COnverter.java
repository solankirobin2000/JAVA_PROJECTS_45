/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.mycompany.converterapi;

import java.io.InputStreamReader;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import java.io.BufferedReader;
import java.util.regex.Pattern;
import java.util.regex.Matcher;


/**
 *
 * @author Nikita
 */
public class COnverter extends javax.swing.JFrame {

    /**
     * Creates new form COnverter
     */
    public COnverter() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        curAmount = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        curFrom = new javax.swing.JComboBox<>();
        curTo = new javax.swing.JComboBox<>();
        btnConvert = new javax.swing.JButton();
        resultDisplay = new javax.swing.JTextField();
        resultDisplayTime = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jPanel1.setBackground(new java.awt.Color(159, 197, 232));

        jLabel1.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N
        jLabel1.setText("Enter Amount :");

        curAmount.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N

        jLabel2.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N
        jLabel2.setText("Currency From: ");

        jLabel3.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N
        jLabel3.setText("Currency to:");

        curFrom.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N
        curFrom.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Euro - EUR", "British Pound - GBP", "United States Dollar - USD", "Australian Dollar - AUD", "Canadian Dollar - CAD", "Swiss Franc - CHF", "Chinese Yuan - CNY", "Hong Kong Dollar - HKD", "Indonesian Rupiah - IDR", "Indian Rupee - INR", "Japanese Yen - JPY", "Thai Baht - THB", "Albanian Lek - ALL", "Algerian Dinar - DZD", "Aluminium Ounces - XAL", "Argentine Peso - ARS", "Aruba Florin - AWG", "Bahamian Dollar - BSD", "Bahraini Dinar - BHD", "Bangladesh Taka - BDT", "Barbados Dollar - BBD", "Belarus Ruble - BYR", "Belize Dollar - BZD", "Bermuda Dollar - BMD", "Bhutan Ngultrum - BTN", "Bolivian Boliviano - BOB", "Botswana Pula - BWP", "Brazilian Real - BRL", "Brunei Dollar - BND", "Bulgarian Lev - BGN", "Burundi Franc - BIF", "Cambodia Riel - KHR", "Cape Verde Escudo - CVE", "Cayman Islands Dollar - KYD", "CFA Franc (BCEAO) - XOF", "CFA Franc (BEAC) - XAF", "Chilean Peso - CLP", "Colombian Peso - COP", "Comoros Franc - KMF", "Copper Pounds - XCP", "Costa Rica Colon - CRC", "Croatian Kuna - HRK", "Cuban Peso - CUP", "Czech Koruna - CZK", "Danish Krone - DKK", "Dijibouti Franc - DJF", "Dominican Peso - DOP", "East Caribbean Dollar - XCD", "Ecuador Sucre - ECS", "Egyptian Pound - EGP", "El Salvador Colon - SVC", "Eritrea Nakfa - ERN", "Estonian Kroon - EEK", "Ethiopian Birr - ETB", "Falkland Islands Pound - FKP", "Fiji Dollar - FJD", "Gambian Dalasi - GMD", "Ghanian Cedi - GHC", "Gibraltar Pound - GIP", "Gold Ounces - XAU", "Guatemala Quetzal - GTQ", "Guinea Franc - GNF", "Guyana Dollar - GYD", "Haiti Gourde - HTG", "Honduras Lempira - HNL", "Hungarian Forint - HUF", "Iceland Krona - ISK", "Iran Rial - IRR", "Iraqi Dinar - IQD", "Israeli Shekel - ILS", "Jamaican Dollar - JMD", "Jordanian Dinar - JOD", "Kazakhstan Tenge - KZT", "Kenyan Shilling - KES", "Korean Won - KRW", "Kuwaiti Dinar - KWD", "Lao Kip - LAK", "Latvian Lat - LVL", "Lebanese Pound - LBP", "Lesotho Loti - LSL", "Liberian Dollar - LRD", "Libyan Dinar - LYD", "Lithuanian Lita - LTL", "Macau Pataca - MOP", "Macedonian Denar - MKD", "Malawi Kwacha - MWK", "Malaysian Ringgit - MYR", "Maldives Rufiyaa - MVR", "Maltese Lira - MTL", "Mauritania Ougulya - MRO", "Mauritius Rupee - MUR", "Mexican Peso - MXN", "Moldovan Leu - MDL", "Mongolian Tugrik - MNT", "Moroccan Dirham - MAD", "Myanmar Kyat - MMK", "Namibian Dollar - NAD", "Nepalese Rupee - NPR", "Neth Antilles Guilder - ANG", "Turkish Lira - TRY", "New Zealand Dollar - NZD", "Nicaragua Cordoba - NIO", "Nigerian Naira - NGN", "North Korean Won - KPW", "Norwegian Krone - NOK", "Omani Rial - OMR", "Pacific Franc - XPF", "Pakistani Rupee - PKR", "Palladium Ounces - XPD", "Panama Balboa - PAB", "Papua New Guinea Kina - PGK", "Paraguayan Guarani - PYG", "Peruvian Nuevo Sol - PEN", "Philippine Peso - PHP", "Platinum Ounces - XPT", "Polish Zloty - PLN", "Qatar Rial - QAR", "Romanian New Leu - RON", "Russian Rouble - RUB", "Rwanda Franc - RWF", "Samoa Tala - WST", "Sao Tome Dobra - STD", "Saudi Arabian Riyal - SAR", "Seychelles Rupee - SCR", "Sierra Leone Leone - SLL", "Silver Ounces - XAG", "Singapore Dollar - SGD", "Slovak Koruna - SKK", "Slovenian Tolar - SIT", "Solomon Islands Dollar - SBD", "Somali Shilling - SOS", "South African Rand - ZAR", "Sri Lanka Rupee - LKR", "St Helena Pound - SHP", "Sudanese Pound - SDG", "Swaziland Lilageni - SZL", "Swedish Krona - SEK", "Syrian Pound - SYP", "Taiwan Dollar - TWD", "Tanzanian Shilling - TZS", "Tonga Pa'ang - TOP", "Trinidad & Tobago Dollar - TTD", "Tunisian Dinar - TND", "UAE Dirham - AED", "Ugandan Shilling - UGX", "Ukraine Hryvnia - UAH", "Uruguayan New Peso - UYU", "Vanuatu Vatu - VUV", "Venezuelan Bolivar Fuerte - VEF", "Vietnam Dong - VND", "Yemen Riyal - YER", "Zambian Kwacha - ZMK", "Zimbabwe dollar - ZWD" }));
        curFrom.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                curFromActionPerformed(evt);
            }
        });

        curTo.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N
        curTo.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Euro - EUR", "British Pound - GBP", "United States Dollar - USD", "Australian Dollar - AUD", "Canadian Dollar - CAD", "Swiss Franc - CHF", "Chinese Yuan - CNY", "Hong Kong Dollar - HKD", "Indonesian Rupiah - IDR", "Indian Rupee - INR", "Japanese Yen - JPY", "Thai Baht - THB", "Albanian Lek - ALL", "Algerian Dinar - DZD", "Aluminium Ounces - XAL", "Argentine Peso - ARS", "Aruba Florin - AWG", "Bahamian Dollar - BSD", "Bahraini Dinar - BHD", "Bangladesh Taka - BDT", "Barbados Dollar - BBD", "Belarus Ruble - BYR", "Belize Dollar - BZD", "Bermuda Dollar - BMD", "Bhutan Ngultrum - BTN", "Bolivian Boliviano - BOB", "Botswana Pula - BWP", "Brazilian Real - BRL", "Brunei Dollar - BND", "Bulgarian Lev - BGN", "Burundi Franc - BIF", "Cambodia Riel - KHR", "Cape Verde Escudo - CVE", "Cayman Islands Dollar - KYD", "CFA Franc (BCEAO) - XOF", "CFA Franc (BEAC) - XAF", "Chilean Peso - CLP", "Colombian Peso - COP", "Comoros Franc - KMF", "Copper Pounds - XCP", "Costa Rica Colon - CRC", "Croatian Kuna - HRK", "Cuban Peso - CUP", "Czech Koruna - CZK", "Danish Krone - DKK", "Dijibouti Franc - DJF", "Dominican Peso - DOP", "East Caribbean Dollar - XCD", "Ecuador Sucre - ECS", "Egyptian Pound - EGP", "El Salvador Colon - SVC", "Eritrea Nakfa - ERN", "Estonian Kroon - EEK", "Ethiopian Birr - ETB", "Falkland Islands Pound - FKP", "Fiji Dollar - FJD", "Gambian Dalasi - GMD", "Ghanian Cedi - GHC", "Gibraltar Pound - GIP", "Gold Ounces - XAU", "Guatemala Quetzal - GTQ", "Guinea Franc - GNF", "Guyana Dollar - GYD", "Haiti Gourde - HTG", "Honduras Lempira - HNL", "Hungarian Forint - HUF", "Iceland Krona - ISK", "Iran Rial - IRR", "Iraqi Dinar - IQD", "Israeli Shekel - ILS", "Jamaican Dollar - JMD", "Jordanian Dinar - JOD", "Kazakhstan Tenge - KZT", "Kenyan Shilling - KES", "Korean Won - KRW", "Kuwaiti Dinar - KWD", "Lao Kip - LAK", "Latvian Lat - LVL", "Lebanese Pound - LBP", "Lesotho Loti - LSL", "Liberian Dollar - LRD", "Libyan Dinar - LYD", "Lithuanian Lita - LTL", "Macau Pataca - MOP", "Macedonian Denar - MKD", "Malawi Kwacha - MWK", "Malaysian Ringgit - MYR", "Maldives Rufiyaa - MVR", "Maltese Lira - MTL", "Mauritania Ougulya - MRO", "Mauritius Rupee - MUR", "Mexican Peso - MXN", "Moldovan Leu - MDL", "Mongolian Tugrik - MNT", "Moroccan Dirham - MAD", "Myanmar Kyat - MMK", "Namibian Dollar - NAD", "Nepalese Rupee - NPR", "Neth Antilles Guilder - ANG", "Turkish Lira - TRY", "New Zealand Dollar - NZD", "Nicaragua Cordoba - NIO", "Nigerian Naira - NGN", "North Korean Won - KPW", "Norwegian Krone - NOK", "Omani Rial - OMR", "Pacific Franc - XPF", "Pakistani Rupee - PKR", "Palladium Ounces - XPD", "Panama Balboa - PAB", "Papua New Guinea Kina - PGK", "Paraguayan Guarani - PYG", "Peruvian Nuevo Sol - PEN", "Philippine Peso - PHP", "Platinum Ounces - XPT", "Polish Zloty - PLN", "Qatar Rial - QAR", "Romanian New Leu - RON", "Russian Rouble - RUB", "Rwanda Franc - RWF", "Samoa Tala - WST", "Sao Tome Dobra - STD", "Saudi Arabian Riyal - SAR", "Seychelles Rupee - SCR", "Sierra Leone Leone - SLL", "Silver Ounces - XAG", "Singapore Dollar - SGD", "Slovak Koruna - SKK", "Slovenian Tolar - SIT", "Solomon Islands Dollar - SBD", "Somali Shilling - SOS", "South African Rand - ZAR", "Sri Lanka Rupee - LKR", "St Helena Pound - SHP", "Sudanese Pound - SDG", "Swaziland Lilageni - SZL", "Swedish Krona - SEK", "Syrian Pound - SYP", "Taiwan Dollar - TWD", "Tanzanian Shilling - TZS", "Tonga Pa'ang - TOP", "Trinidad & Tobago Dollar - TTD", "Tunisian Dinar - TND", "UAE Dirham - AED", "Ugandan Shilling - UGX", "Ukraine Hryvnia - UAH", "Uruguayan New Peso - UYU", "Vanuatu Vatu - VUV", "Venezuelan Bolivar Fuerte - VEF", "Vietnam Dong - VND", "Yemen Riyal - YER", "Zambian Kwacha - ZMK", "Zimbabwe dollar - ZWD" }));
        curTo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                curToActionPerformed(evt);
            }
        });

        btnConvert.setBackground(new java.awt.Color(159, 197, 232));
        btnConvert.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N
        btnConvert.setText("Convert");
        btnConvert.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnConvertActionPerformed(evt);
            }
        });

        resultDisplay.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(101, 101, 101)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(resultDisplay)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addComponent(jLabel2, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(curFrom, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 199, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(jLabel1, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addComponent(btnConvert, javax.swing.GroupLayout.PREFERRED_SIZE, 172, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(67, 67, 67)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel3, javax.swing.GroupLayout.DEFAULT_SIZE, 188, Short.MAX_VALUE)
                            .addComponent(curAmount)
                            .addComponent(curTo, 0, 1, Short.MAX_VALUE)
                            .addComponent(resultDisplayTime, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                .addContainerGap(107, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(41, 41, 41)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(curAmount, javax.swing.GroupLayout.DEFAULT_SIZE, 41, Short.MAX_VALUE))
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(jLabel3))
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(curFrom, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(curTo, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(47, 47, 47)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(btnConvert, javax.swing.GroupLayout.DEFAULT_SIZE, 32, Short.MAX_VALUE)
                    .addComponent(resultDisplayTime, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(32, 32, 32)
                .addComponent(resultDisplay, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(75, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnConvertActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnConvertActionPerformed
        // Get the amount to convert
       String curAmountText = curAmount.getText();
       // Check for numbers only
       for(int i=0;i < curAmountText.length();i++)
       {
           if(!Character.isDigit(curAmountText.charAt(i)))
           {
               JOptionPane.showMessageDialog(this, "Please enter a valid amount!");
               curAmount.requestFocus();
               return;
           }
       }

       resultDisplay.setText("");

       // Get curreny from and to
       String curFromText   = curFrom.getSelectedItem().toString();
       String curToText     = curTo.getSelectedItem().toString();

       String[] temp = null;
       temp = curFromText.split(" - ");
       String curFromTitle = temp[0];
       String curFromCode = temp[1];

       temp = curToText.split(" - ");
       String curToTitle = temp[0];
       String curToCode = temp[1];

       String URL = "http://finance.yahoo.com/d/quotes.csv?f=l1&s=" + curFromCode + "" + curToCode + "=X&t=5d&l=on&z=m&q=l&c=";

        try {
            // Fetch results from Yahoo
            String results = "";
            URL thePage = new URL(URL);
            BufferedReader in = new BufferedReader(new InputStreamReader(thePage.openStream()));
            String inputLine;

            while ((inputLine = in.readLine()) != null) {
              // Process each line.
              results = results + inputLine;
            }
            in.close();
            // Parrent matching
            Pattern finalPattern = Pattern.compile("x\">([0-9.]+)</span>");
            Matcher matchFind = finalPattern.matcher(results);
            matchFind.find();

            double curRate = Double.valueOf(matchFind.group(1)).doubleValue();
            double totalConvert = curRate * Double.valueOf(curAmount.getText()).doubleValue();

            // Trade Time Matching
            finalPattern = Pattern.compile("<span id=\"yfs_t10_[a-zA-Z]+=x\">(.*)</span>:");
            matchFind = finalPattern.matcher(results);
            matchFind.find();

            resultDisplay.setText(String.format("%,.2f", totalConvert));
            resultDisplayTime.setText("Per Trade Time: "+matchFind.group(1));
       } catch (Exception e) {
           // Do error handling
           JOptionPane.showMessageDialog(this, "Unable to connect to Yahoo Finance!");
       }
    }//GEN-LAST:event_btnConvertActionPerformed

    private void curToActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_curToActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_curToActionPerformed

    private void curFromActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_curFromActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_curFromActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(COnverter.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(COnverter.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(COnverter.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(COnverter.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new COnverter().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnConvert;
    private javax.swing.JTextField curAmount;
    private javax.swing.JComboBox<String> curFrom;
    private javax.swing.JComboBox<String> curTo;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JTextField resultDisplay;
    private javax.swing.JLabel resultDisplayTime;
    // End of variables declaration//GEN-END:variables
}
